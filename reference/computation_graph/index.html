
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../developer/torch_function_notes/">
      
      
        <link rel="next" href="../recorder_tensor/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Computation graph - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#torchview.computation_graph" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Computation graph
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torchview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Developer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/rolling_graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to identify nodes and roll recursive graphs ?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/torch_function_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch_function
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Computation graph
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Computation graph
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph" class="md-nav__link">
    <span class="md-ellipsis">
      computation_graph
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph" class="md-nav__link">
    <span class="md-ellipsis">
      ComputationGraph
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ComputationGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.add_node" class="md-nav__link">
    <span class="md-ellipsis">
      add_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.collect_graph" class="md-nav__link">
    <span class="md-ellipsis">
      collect_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.fill_visual_graph" class="md-nav__link">
    <span class="md-ellipsis">
      fill_visual_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.get_node_label" class="md-nav__link">
    <span class="md-ellipsis">
      get_node_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.is_node_visible" class="md-nav__link">
    <span class="md-ellipsis">
      is_node_visible
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.render_edges" class="md-nav__link">
    <span class="md-ellipsis">
      render_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.reset_graph_history" class="md-nav__link">
    <span class="md-ellipsis">
      reset_graph_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.resize_graph" class="md-nav__link">
    <span class="md-ellipsis">
      resize_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.rollify" class="md-nav__link">
    <span class="md-ellipsis">
      rollify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph.compact_list_repr" class="md-nav__link">
    <span class="md-ellipsis">
      compact_list_repr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph.get_output_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_id
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../recorder_tensor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recorder tensor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../torchview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Torchview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Computation node
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Computation node
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computation_node/base_node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computation_node/compute_node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compute node
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/example_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example introduction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph" class="md-nav__link">
    <span class="md-ellipsis">
      computation_graph
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph" class="md-nav__link">
    <span class="md-ellipsis">
      ComputationGraph
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ComputationGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.add_node" class="md-nav__link">
    <span class="md-ellipsis">
      add_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.collect_graph" class="md-nav__link">
    <span class="md-ellipsis">
      collect_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.fill_visual_graph" class="md-nav__link">
    <span class="md-ellipsis">
      fill_visual_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.get_node_label" class="md-nav__link">
    <span class="md-ellipsis">
      get_node_label
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.is_node_visible" class="md-nav__link">
    <span class="md-ellipsis">
      is_node_visible
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.render_edges" class="md-nav__link">
    <span class="md-ellipsis">
      render_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.reset_graph_history" class="md-nav__link">
    <span class="md-ellipsis">
      reset_graph_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.resize_graph" class="md-nav__link">
    <span class="md-ellipsis">
      resize_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torchview.computation_graph.ComputationGraph.rollify" class="md-nav__link">
    <span class="md-ellipsis">
      rollify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph.compact_list_repr" class="md-nav__link">
    <span class="md-ellipsis">
      compact_list_repr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torchview.computation_graph.get_output_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_output_id
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Computation graph</h1>

<div class="doc doc-object doc-module">



<a id="torchview.computation_graph"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="torchview.computation_graph.ComputationGraph" class="doc doc-heading">
            <code>ComputationGraph</code>


</h2>


    <div class="doc doc-contents ">


        <p>A class to represent Computational graph and visualization of pytorch model</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="torchview.computation_graph.ComputationGraph.visual_graph">visual_graph</span></code></td>
            <td>
                  <code><span title="graphviz.Digraph">Digraph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graphviz.Digraph object to represent computational graph of
pytorch model</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="torchview.computation_graph.ComputationGraph.root_container">root_container</span></code></td>
            <td>
                  <code><span title="torchview.computation_node.NodeContainer">NodeContainer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterable of TensorNodes to represent all input/root nodes
of pytorch model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="torchview.computation_graph.ComputationGraph.show_shapes">show_shapes</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show shapes of tensor/input/outputs</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="torchview.computation_graph.ComputationGraph.hide_module_functions">hide_module_functions</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Some modules contain only torch.function and no submodule,
e.g. nn.Conv2d. They are usually implemented to do one type
of computation, e.g. Conv2d -&gt; 2D Convolution. If True,
visual graph only displays the module itself,
while ignoring its inner functions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="torchview.computation_graph.ComputationGraph.hide_inner_tensors">hide_inner_tensors</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to hide inner tensors in graphviz graph object</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="torchview.computation_graph.ComputationGraph.node_hierarchy">node_hierarchy</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Represents nested hierarchy of ComputationNodes by nested dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>torchview/computation_graph.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ComputationGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;A class to represent Computational graph and visualization of pytorch model</span>

<span class="sd">    Attributes:</span>
<span class="sd">        visual_graph (Digraph):</span>
<span class="sd">            Graphviz.Digraph object to represent computational graph of</span>
<span class="sd">            pytorch model</span>

<span class="sd">        root_container (NodeContainer):</span>
<span class="sd">            Iterable of TensorNodes to represent all input/root nodes</span>
<span class="sd">            of pytorch model.</span>

<span class="sd">        show_shapes (bool):</span>
<span class="sd">            Whether to show shapes of tensor/input/outputs</span>

<span class="sd">        hide_module_functions (bool):</span>
<span class="sd">            Some modules contain only torch.function and no submodule,</span>
<span class="sd">            e.g. nn.Conv2d. They are usually implemented to do one type</span>
<span class="sd">            of computation, e.g. Conv2d -&gt; 2D Convolution. If True,</span>
<span class="sd">            visual graph only displays the module itself,</span>
<span class="sd">            while ignoring its inner functions.</span>

<span class="sd">        hide_inner_tensors (bool):</span>
<span class="sd">            Whether to hide inner tensors in graphviz graph object</span>


<span class="sd">        node_hierarchy dict:</span>
<span class="sd">            Represents nested hierarchy of ComputationNodes by nested dictionary</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">visual_graph</span><span class="p">:</span> <span class="n">Digraph</span><span class="p">,</span>
        <span class="n">root_container</span><span class="p">:</span> <span class="n">NodeContainer</span><span class="p">[</span><span class="n">TensorNode</span><span class="p">],</span>
        <span class="n">show_shapes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">expand_nested</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hide_inner_tensors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">hide_module_functions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">roll</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Resets the running_node_id, id_dict when a new ComputationGraph is initialized.</span>
<span class="sd">        Otherwise, labels would depend on previous ComputationGraph runs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span> <span class="o">=</span> <span class="n">visual_graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_container</span> <span class="o">=</span> <span class="n">root_container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_shapes</span> <span class="o">=</span> <span class="n">show_shapes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_nested</span> <span class="o">=</span> <span class="n">expand_nested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_inner_tensors</span> <span class="o">=</span> <span class="n">hide_inner_tensors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_module_functions</span> <span class="o">=</span> <span class="n">hide_module_functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="n">roll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>

        <span class="c1"># specs for html table, needed for node labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;cell_border&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;cell_spacing&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;cell_padding&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;col_span&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;row_span&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_graph_history</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset_graph_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Resets to id config to the setting of empty visual graph</span>
<span class="sd">        needed for getting reproducible/deterministic node name and</span>
<span class="sd">        graphviz graphs. This is especially important for output tests</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;current_context&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;current_depth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_node_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_set</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">COMPUTATION_NODES</span><span class="p">,</span> <span class="n">COMPUTATION_NODES</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># module node  to capture whole graph</span>
        <span class="n">main_container_module</span> <span class="o">=</span> <span class="n">ModuleNode</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">main_container_module</span><span class="o">.</span><span class="n">is_container</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">main_container_module</span><span class="o">.</span><span class="n">node_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Add input nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_hierarchy</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">main_container_module</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_container</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">root_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_container</span><span class="p">:</span>
            <span class="n">root_node</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_hierarchy</span><span class="p">[</span><span class="n">main_container_module</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fill_visual_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Fills the graphviz graph with desired nodes and edges.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">render_nodes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render_edges</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize_graph</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cur_node&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_hierarchy</span><span class="p">,</span>
            <span class="s1">&#39;subgraph&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traverse_graph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collect_graph</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">render_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Records all edges in self.edge_list to</span>
<span class="sd">        the graphviz graph using node ids from edge_list&#39;&#39;&#39;</span>
        <span class="n">edge_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">tail</span><span class="p">,</span> <span class="n">head</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="p">:</span>
            <span class="n">edge_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">tail</span><span class="o">.</span><span class="n">node_id</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">head</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span>
            <span class="n">edge_counter</span><span class="p">[</span><span class="n">edge_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_counter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge_id</span><span class="p">,</span> <span class="n">edge_counter</span><span class="p">[</span><span class="n">edge_id</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">traverse_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">action_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cur_node</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cur_node&#39;</span><span class="p">]</span>
        <span class="n">cur_subgraph</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span> <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subgraph&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subgraph&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">assert_input_type</span><span class="p">(</span>
            <span class="s1">&#39;traverse_graph&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">TensorNode</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="n">cur_node</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="p">(</span><span class="n">TensorNode</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">:</span>
                <span class="n">action_fn</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_kwargs</span> <span class="o">=</span> <span class="n">updated_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;cur_node&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">action_fn</span><span class="p">(</span><span class="o">**</span><span class="n">new_kwargs</span><span class="p">)</span>

            <span class="c1"># if it is container module, move directly to outputs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_module_functions</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">is_container</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">k</span><span class="o">.</span><span class="n">output_nodes</span><span class="p">:</span>
                    <span class="n">new_kwargs</span> <span class="o">=</span> <span class="n">updated_dict</span><span class="p">(</span><span class="n">new_kwargs</span><span class="p">,</span> <span class="s1">&#39;cur_node&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">traverse_graph</span><span class="p">(</span><span class="n">action_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">new_kwargs</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">display_nested</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">k</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_nested</span>
            <span class="p">)</span>

            <span class="k">with</span> <span class="p">(</span>
                <span class="n">cur_subgraph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;cluster_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">display_nested</span> <span class="k">else</span> <span class="n">nullcontext</span><span class="p">()</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">cur_cont</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">display_nested</span><span class="p">:</span>
                    <span class="n">cur_cont</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span>
                        <span class="n">style</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">labeljust</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;12&#39;</span>
                    <span class="p">)</span>
                    <span class="n">new_kwargs</span> <span class="o">=</span> <span class="n">updated_dict</span><span class="p">(</span><span class="n">new_kwargs</span><span class="p">,</span> <span class="s1">&#39;subgraph&#39;</span><span class="p">,</span> <span class="n">cur_cont</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">new_kwargs</span> <span class="o">=</span> <span class="n">updated_dict</span><span class="p">(</span><span class="n">new_kwargs</span><span class="p">,</span> <span class="s1">&#39;cur_node&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">traverse_graph</span><span class="p">(</span><span class="n">action_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">new_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Adds edges and nodes with appropriate node name/id (so it respects</span>
<span class="sd">        properties e.g. if rolled recursive nodes are given the same node name</span>
<span class="sd">        in graphviz graph)&#39;&#39;&#39;</span>

        <span class="n">cur_node</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cur_node&#39;</span><span class="p">]</span>
        <span class="c1"># if tensor node is traced, dont repeat collecting</span>
        <span class="c1"># if node is isolated, dont record it</span>
        <span class="n">is_isolated</span> <span class="o">=</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">()</span> <span class="ow">and</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set</span> <span class="ow">or</span> <span class="n">is_isolated</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
        <span class="n">is_cur_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
        <span class="c1"># add node</span>
        <span class="k">if</span> <span class="n">is_cur_visible</span><span class="p">:</span>
            <span class="n">subgraph</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subgraph&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="p">(</span><span class="n">FunctionNode</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rollify</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">):</span>
            <span class="c1"># add subgraph</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rollify</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">[</span><span class="n">cur_node</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># add edges only through</span>
        <span class="c1"># node -&gt; TensorNode -&gt; Node connection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># add edges</span>
        <span class="c1"># {cur_node -&gt; head} part</span>
        <span class="n">tail_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tail_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
        <span class="n">is_main_node_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">main_node</span><span class="p">)</span>
        <span class="n">is_tail_node_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">tail_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">children_node</span> <span class="ow">in</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">is_output_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">children_node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_output_visible</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_main_node_visible</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">children_node</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">is_tail_node_visible</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">children_node</span><span class="p">))</span>

        <span class="c1"># {tail -&gt; cur_node} part</span>
        <span class="c1"># # output node</span>
        <span class="c1"># visible tensor and non-input tensor nodes</span>
        <span class="k">if</span> <span class="n">is_cur_visible</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">():</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tail_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">(),</span> <span class="p">(</span>
                <span class="s2">&quot;get_tail_node function returned inconsistent Node, please report this&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">cur_node</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rollify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur_node</span><span class="p">:</span> <span class="n">ModuleNode</span> <span class="o">|</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Rolls computational graph by identifying recursively used</span>
<span class="sd">        Modules. This is done by giving the same id for nodes that are</span>
<span class="sd">        recursively used.</span>
<span class="sd">        This becomes complex when there are stateless and torch.functions.</span>
<span class="sd">        For more details see docs&#39;&#39;&#39;</span>

        <span class="n">head_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">output_nodes</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">head_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_inner_tensors</span><span class="p">:</span>
            <span class="n">head_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">head_node</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>

        <span class="c1"># identify recursively used modules</span>
        <span class="c1"># with the same node id</span>
        <span class="n">output_id</span> <span class="o">=</span> <span class="n">get_output_id</span><span class="p">(</span><span class="n">head_node</span><span class="p">)</span>
        <span class="n">cur_node</span><span class="o">.</span><span class="n">set_node_id</span><span class="p">(</span><span class="n">output_id</span><span class="o">=</span><span class="n">output_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_node_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute_node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Returns True if node should be displayed on the visual</span>
<span class="sd">        graph. Otherwise False&#39;&#39;&#39;</span>

        <span class="n">assert_input_type</span><span class="p">(</span>
            <span class="s1">&#39;is_node_visible&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">TensorNode</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">,),</span> <span class="n">compute_node</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;empty-pass&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compute_node</span><span class="p">,</span> <span class="p">(</span><span class="n">ModuleNode</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">)):</span>
            <span class="n">is_visible</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">compute_node</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide_module_functions</span> <span class="ow">and</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">is_container</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">is_visible</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">main_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">is_aux</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">is_main_input_or_output</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">compute_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">()</span> <span class="ow">or</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">())</span>
                <span class="ow">and</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">is_visible</span> <span class="o">=</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_inner_tensors</span> <span class="ow">or</span> <span class="n">is_main_input_or_output</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">is_visible</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_tail_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_tensor_node</span><span class="p">:</span> <span class="n">TensorNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">COMPUTATION_NODES</span><span class="p">:</span>

        <span class="n">tensor_node</span> <span class="o">=</span> <span class="n">_tensor_node</span><span class="o">.</span><span class="n">main_node</span> <span class="k">if</span> <span class="n">_tensor_node</span><span class="o">.</span><span class="n">is_aux</span> <span class="k">else</span> <span class="n">_tensor_node</span>

        <span class="c1"># non-output nodes eminating from input node</span>
        <span class="k">if</span> <span class="n">tensor_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">tensor_node</span>

        <span class="n">current_parent_h</span> <span class="o">=</span> <span class="n">tensor_node</span><span class="o">.</span><span class="n">parent_hierarchy</span>

        <span class="n">sorted_depth</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">depth</span> <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">current_parent_h</span><span class="p">)</span>
        <span class="n">tail_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">tensor_node</span><span class="o">.</span><span class="n">parents</span><span class="p">))</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">sorted_depth</span><span class="p">:</span>
            <span class="n">tail_node</span> <span class="o">=</span> <span class="n">current_parent_h</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">module_depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># if returned by container module and hide_module_functions</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_parent_h</span><span class="p">[</span><span class="n">depth</span><span class="p">],</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">module_depth</span> <span class="ow">in</span> <span class="n">tensor_node</span><span class="o">.</span><span class="n">parent_hierarchy</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_module_functions</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">current_parent_h</span><span class="p">[</span><span class="n">module_depth</span><span class="p">]</span><span class="o">.</span><span class="n">is_container</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">current_parent_h</span><span class="p">[</span><span class="n">module_depth</span><span class="p">]</span>

        <span class="c1"># Even though this is recursive, not harmful for complexity</span>
        <span class="c1"># The reason: the (time) complexity ~ O(L^2) where L</span>
        <span class="c1"># is the length of CONTINUOUS path along which the same tensor is passed</span>
        <span class="c1"># without any operation on it. L is always small since we dont use</span>
        <span class="c1"># infinitely big network with infinitely big continuou pass of unchanged</span>
        <span class="c1"># tensor. This recursion is necessary e.g. for LDC model</span>
        <span class="k">if</span> <span class="n">tail_node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;empty-pass&#39;</span><span class="p">:</span>
            <span class="n">empty_pass_parent</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">((</span><span class="n">tail_node</span><span class="o">.</span><span class="n">parents</span><span class="p">)))</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">empty_pass_parent</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">),</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">empty_pass_parent</span><span class="si">}</span><span class="s1"> is input of </span><span class="si">{</span><span class="n">tail_node</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;and must a be TensorNode&#39;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tail_node</span><span class="p">(</span><span class="n">empty_pass_parent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tail_node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">edge_ids</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">edg_cnt</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">tail_id</span><span class="p">,</span> <span class="n">head_id</span> <span class="o">=</span> <span class="n">edge_ids</span>
        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">edg_cnt</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39; x</span><span class="si">{</span><span class="n">edg_cnt</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tail_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">head_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">:</span> <span class="n">Digraph</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Adds node to the graphviz with correct id, label and color</span>
<span class="sd">        settings. Updates state of running_node_id if node is not</span>
<span class="sd">        identified before.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_node_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running_node_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_label</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">node_color</span> <span class="o">=</span> <span class="n">ComputationGraph</span><span class="o">.</span><span class="n">get_node_color</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">subgraph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span>
        <span class="n">subgraph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">node_color</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_node_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Returns html-like format for the label of node. This html-like</span>
<span class="sd">        label is based on Graphviz API for html-like format. For setting of node label</span>
<span class="sd">        it uses graph config and html_config.&#39;&#39;&#39;</span>
        <span class="n">input_str</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span>
        <span class="n">output_str</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
        <span class="n">border</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;border&#39;</span><span class="p">]</span>
        <span class="n">cell_sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;cell_spacing&#39;</span><span class="p">]</span>
        <span class="n">cell_pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;cell_padding&#39;</span><span class="p">]</span>
        <span class="n">cell_bor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;cell_border&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_shapes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;</span>
<span class="s1">                    &lt;TABLE BORDER=&quot;</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s1">&quot; CELLBORDER=&quot;</span><span class="si">{</span><span class="n">cell_bor</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                    CELLSPACING=&quot;</span><span class="si">{</span><span class="n">cell_sp</span><span class="si">}</span><span class="s1">&quot; CELLPADDING=&quot;</span><span class="si">{</span><span class="n">cell_pad</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                        &lt;TR&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;BR/&gt;depth:</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">tensor_shape</span><span class="si">}</span><span class="s1">&lt;/TD&gt;&lt;/TR&gt;</span>
<span class="s1">                    &lt;/TABLE&gt;&gt;&#39;&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">input_repr</span> <span class="o">=</span> <span class="n">compact_list_repr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">input_shape</span><span class="p">)</span>
                <span class="n">output_repr</span> <span class="o">=</span> <span class="n">compact_list_repr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">output_shape</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;</span>
<span class="s1">                    &lt;TABLE BORDER=&quot;</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s1">&quot; CELLBORDER=&quot;</span><span class="si">{</span><span class="n">cell_bor</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                    CELLSPACING=&quot;</span><span class="si">{</span><span class="n">cell_sp</span><span class="si">}</span><span class="s1">&quot; CELLPADDING=&quot;</span><span class="si">{</span><span class="n">cell_pad</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                    &lt;TR&gt;</span>
<span class="s1">                        &lt;TD ROWSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;BR/&gt;depth:</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">&lt;/TD&gt;</span>
<span class="s1">                        &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">input_str</span><span class="si">}</span><span class="s1">:&lt;/TD&gt;</span>
<span class="s1">                        &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">input_repr</span><span class="si">}</span><span class="s1"> &lt;/TD&gt;</span>
<span class="s1">                    &lt;/TR&gt;</span>
<span class="s1">                    &lt;TR&gt;</span>
<span class="s1">                        &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">output_str</span><span class="si">}</span><span class="s1">: &lt;/TD&gt;</span>
<span class="s1">                        &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">output_repr</span><span class="si">}</span><span class="s1"> &lt;/TD&gt;</span>
<span class="s1">                    &lt;/TR&gt;</span>
<span class="s1">                    &lt;/TABLE&gt;&gt;&#39;&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;</span>
<span class="s1">                    &lt;TABLE BORDER=&quot;</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s1">&quot; CELLBORDER=&quot;</span><span class="si">{</span><span class="n">cell_bor</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                    CELLSPACING=&quot;</span><span class="si">{</span><span class="n">cell_sp</span><span class="si">}</span><span class="s1">&quot; CELLPADDING=&quot;</span><span class="si">{</span><span class="n">cell_pad</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                        &lt;TR&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;BR/&gt;depth:</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">&lt;/TD&gt;&lt;/TR&gt;</span>
<span class="s1">                    &lt;/TABLE&gt;&gt;&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">label</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resize_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">size_per_element</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="n">min_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resize the graph according to how much content it contains.</span>
<span class="sd">        Modify the graph in place. Default values are subject to change,</span>
<span class="sd">        so far they seem to work fine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the approximate number of nodes and edges</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="n">content_size</span> <span class="o">=</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">size_per_element</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">content_size</span><span class="p">)</span>
        <span class="n">size_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span><span class="o">.</span><span class="n">graph_attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size_str</span><span class="p">,)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_node_color</span><span class="p">(</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node2color</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">node_id</span> <span class="o">!=</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;wrong id </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;No repetition of node recording is allowed&#39;</span>
        <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Exceeds display depth limit, </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">parents</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">)</span>
        <span class="p">),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;tensor must have single input node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">visual_graph</span><span class="p">,</span> <span class="n">root_container</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expand_nested</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_inner_tensors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hide_module_functions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">roll</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Resets the running_node_id, id_dict when a new ComputationGraph is initialized.
Otherwise, labels would depend on previous ComputationGraph runs</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">visual_graph</span><span class="p">:</span> <span class="n">Digraph</span><span class="p">,</span>
    <span class="n">root_container</span><span class="p">:</span> <span class="n">NodeContainer</span><span class="p">[</span><span class="n">TensorNode</span><span class="p">],</span>
    <span class="n">show_shapes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">expand_nested</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hide_inner_tensors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">hide_module_functions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">roll</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Resets the running_node_id, id_dict when a new ComputationGraph is initialized.</span>
<span class="sd">    Otherwise, labels would depend on previous ComputationGraph runs</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span> <span class="o">=</span> <span class="n">visual_graph</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root_container</span> <span class="o">=</span> <span class="n">root_container</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show_shapes</span> <span class="o">=</span> <span class="n">show_shapes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expand_nested</span> <span class="o">=</span> <span class="n">expand_nested</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hide_inner_tensors</span> <span class="o">=</span> <span class="n">hide_inner_tensors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hide_module_functions</span> <span class="o">=</span> <span class="n">hide_module_functions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="n">roll</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>

    <span class="c1"># specs for html table, needed for node labels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;cell_border&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;cell_spacing&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;cell_padding&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;col_span&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;row_span&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_graph_history</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.add_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">subgraph</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adds node to the graphviz with correct id, label and color
settings. Updates state of running_node_id if node is not
identified before.</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">:</span> <span class="n">Digraph</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Adds node to the graphviz with correct id, label and color</span>
<span class="sd">    settings. Updates state of running_node_id if node is not</span>
<span class="sd">    identified before.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_node_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_node_id</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_label</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">node_color</span> <span class="o">=</span> <span class="n">ComputationGraph</span><span class="o">.</span><span class="n">get_node_color</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subgraph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span>
    <span class="n">subgraph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="n">node_color</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.collect_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_graph</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adds edges and nodes with appropriate node name/id (so it respects
properties e.g. if rolled recursive nodes are given the same node name
in graphviz graph)</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collect_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Adds edges and nodes with appropriate node name/id (so it respects</span>
<span class="sd">    properties e.g. if rolled recursive nodes are given the same node name</span>
<span class="sd">    in graphviz graph)&#39;&#39;&#39;</span>

    <span class="n">cur_node</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cur_node&#39;</span><span class="p">]</span>
    <span class="c1"># if tensor node is traced, dont repeat collecting</span>
    <span class="c1"># if node is isolated, dont record it</span>
    <span class="n">is_isolated</span> <span class="o">=</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">()</span> <span class="ow">and</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_set</span> <span class="ow">or</span> <span class="n">is_isolated</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
    <span class="n">is_cur_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
    <span class="c1"># add node</span>
    <span class="k">if</span> <span class="n">is_cur_visible</span><span class="p">:</span>
        <span class="n">subgraph</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subgraph&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="p">(</span><span class="n">FunctionNode</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rollify</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">):</span>
        <span class="c1"># add subgraph</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rollify</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">[</span><span class="n">cur_node</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># add edges only through</span>
    <span class="c1"># node -&gt; TensorNode -&gt; Node connection</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="c1"># add edges</span>
    <span class="c1"># {cur_node -&gt; head} part</span>
    <span class="n">tail_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tail_node</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
    <span class="n">is_main_node_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">main_node</span><span class="p">)</span>
    <span class="n">is_tail_node_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">tail_node</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">children_node</span> <span class="ow">in</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">is_output_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_node_visible</span><span class="p">(</span><span class="n">children_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_output_visible</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_main_node_visible</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">children_node</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">is_tail_node_visible</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">children_node</span><span class="p">))</span>

    <span class="c1"># {tail -&gt; cur_node} part</span>
    <span class="c1"># # output node</span>
    <span class="c1"># visible tensor and non-input tensor nodes</span>
    <span class="k">if</span> <span class="n">is_cur_visible</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cur_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">():</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tail_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">(),</span> <span class="p">(</span>
            <span class="s2">&quot;get_tail_node function returned inconsistent Node, please report this&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tail_node</span><span class="p">,</span> <span class="n">cur_node</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.fill_visual_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_visual_graph</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fills the graphviz graph with desired nodes and edges.</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_visual_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Fills the graphviz graph with desired nodes and edges.&#39;&#39;&#39;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">render_nodes</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">render_edges</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resize_graph</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.get_node_label" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_node_label</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns html-like format for the label of node. This html-like
label is based on Graphviz API for html-like format. For setting of node label
it uses graph config and html_config.</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_node_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns html-like format for the label of node. This html-like</span>
<span class="sd">    label is based on Graphviz API for html-like format. For setting of node label</span>
<span class="sd">    it uses graph config and html_config.&#39;&#39;&#39;</span>
    <span class="n">input_str</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span>
    <span class="n">output_str</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
    <span class="n">border</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;border&#39;</span><span class="p">]</span>
    <span class="n">cell_sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;cell_spacing&#39;</span><span class="p">]</span>
    <span class="n">cell_pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;cell_padding&#39;</span><span class="p">]</span>
    <span class="n">cell_bor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_config</span><span class="p">[</span><span class="s1">&#39;cell_border&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_shapes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">TensorNode</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;</span>
<span class="s1">                &lt;TABLE BORDER=&quot;</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s1">&quot; CELLBORDER=&quot;</span><span class="si">{</span><span class="n">cell_bor</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                CELLSPACING=&quot;</span><span class="si">{</span><span class="n">cell_sp</span><span class="si">}</span><span class="s1">&quot; CELLPADDING=&quot;</span><span class="si">{</span><span class="n">cell_pad</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                    &lt;TR&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;BR/&gt;depth:</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">&lt;/TD&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">tensor_shape</span><span class="si">}</span><span class="s1">&lt;/TD&gt;&lt;/TR&gt;</span>
<span class="s1">                &lt;/TABLE&gt;&gt;&#39;&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_repr</span> <span class="o">=</span> <span class="n">compact_list_repr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">input_shape</span><span class="p">)</span>
            <span class="n">output_repr</span> <span class="o">=</span> <span class="n">compact_list_repr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">output_shape</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;</span>
<span class="s1">                &lt;TABLE BORDER=&quot;</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s1">&quot; CELLBORDER=&quot;</span><span class="si">{</span><span class="n">cell_bor</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                CELLSPACING=&quot;</span><span class="si">{</span><span class="n">cell_sp</span><span class="si">}</span><span class="s1">&quot; CELLPADDING=&quot;</span><span class="si">{</span><span class="n">cell_pad</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                &lt;TR&gt;</span>
<span class="s1">                    &lt;TD ROWSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;BR/&gt;depth:</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">&lt;/TD&gt;</span>
<span class="s1">                    &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">input_str</span><span class="si">}</span><span class="s1">:&lt;/TD&gt;</span>
<span class="s1">                    &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">input_repr</span><span class="si">}</span><span class="s1"> &lt;/TD&gt;</span>
<span class="s1">                &lt;/TR&gt;</span>
<span class="s1">                &lt;TR&gt;</span>
<span class="s1">                    &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">output_str</span><span class="si">}</span><span class="s1">: &lt;/TD&gt;</span>
<span class="s1">                    &lt;TD COLSPAN=&quot;2&quot;&gt;</span><span class="si">{</span><span class="n">output_repr</span><span class="si">}</span><span class="s1"> &lt;/TD&gt;</span>
<span class="s1">                &lt;/TR&gt;</span>
<span class="s1">                &lt;/TABLE&gt;&gt;&#39;&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;</span>
<span class="s1">                &lt;TABLE BORDER=&quot;</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s1">&quot; CELLBORDER=&quot;</span><span class="si">{</span><span class="n">cell_bor</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                CELLSPACING=&quot;</span><span class="si">{</span><span class="n">cell_sp</span><span class="si">}</span><span class="s1">&quot; CELLPADDING=&quot;</span><span class="si">{</span><span class="n">cell_pad</span><span class="si">}</span><span class="s1">&quot;&gt;</span>
<span class="s1">                    &lt;TR&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&lt;BR/&gt;depth:</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">&lt;/TD&gt;&lt;/TR&gt;</span>
<span class="s1">                &lt;/TABLE&gt;&gt;&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">label</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.is_node_visible" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_node_visible</span><span class="p">(</span><span class="n">compute_node</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns True if node should be displayed on the visual
graph. Otherwise False</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_node_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute_node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns True if node should be displayed on the visual</span>
<span class="sd">    graph. Otherwise False&#39;&#39;&#39;</span>

    <span class="n">assert_input_type</span><span class="p">(</span>
        <span class="s1">&#39;is_node_visible&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">TensorNode</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">,),</span> <span class="n">compute_node</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;empty-pass&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compute_node</span><span class="p">,</span> <span class="p">(</span><span class="n">ModuleNode</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">)):</span>
        <span class="n">is_visible</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">compute_node</span><span class="p">,</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide_module_functions</span> <span class="ow">and</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">is_container</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">is_visible</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">main_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">is_aux</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">is_main_input_or_output</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">compute_node</span><span class="o">.</span><span class="n">is_root</span><span class="p">()</span> <span class="ow">or</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">())</span>
            <span class="ow">and</span> <span class="n">compute_node</span><span class="o">.</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">is_visible</span> <span class="o">=</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_inner_tensors</span> <span class="ow">or</span> <span class="n">is_main_input_or_output</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">is_visible</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.render_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">render_edges</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Records all edges in self.edge_list to
the graphviz graph using node ids from edge_list</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Records all edges in self.edge_list to</span>
<span class="sd">    the graphviz graph using node ids from edge_list&#39;&#39;&#39;</span>
    <span class="n">edge_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">tail</span><span class="p">,</span> <span class="n">head</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="p">:</span>
        <span class="n">edge_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">tail</span><span class="o">.</span><span class="n">node_id</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">[</span><span class="n">head</span><span class="o">.</span><span class="n">node_id</span><span class="p">]</span>
        <span class="n">edge_counter</span><span class="p">[</span><span class="n">edge_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_counter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge_id</span><span class="p">,</span> <span class="n">edge_counter</span><span class="p">[</span><span class="n">edge_id</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.reset_graph_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset_graph_history</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Resets to id config to the setting of empty visual graph
needed for getting reproducible/deterministic node name and
graphviz graphs. This is especially important for output tests</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reset_graph_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Resets to id config to the setting of empty visual graph</span>
<span class="sd">    needed for getting reproducible/deterministic node name and</span>
<span class="sd">    graphviz graphs. This is especially important for output tests</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context_tracker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;current_context&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;current_depth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_node_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_set</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edge_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">COMPUTATION_NODES</span><span class="p">,</span> <span class="n">COMPUTATION_NODES</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># module node  to capture whole graph</span>
    <span class="n">main_container_module</span> <span class="o">=</span> <span class="n">ModuleNode</span><span class="p">(</span><span class="n">Identity</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main_container_module</span><span class="o">.</span><span class="n">is_container</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subgraph_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">main_container_module</span><span class="o">.</span><span class="n">node_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">running_subgraph_id</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Add input nodes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_hierarchy</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">main_container_module</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_container</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">root_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_container</span><span class="p">:</span>
        <span class="n">root_node</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_hierarchy</span><span class="p">[</span><span class="n">main_container_module</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.resize_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resize_graph</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size_per_element</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Resize the graph according to how much content it contains.
Modify the graph in place. Default values are subject to change,
so far they seem to work fine.</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resize_graph</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">size_per_element</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">min_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resize the graph according to how much content it contains.</span>
<span class="sd">    Modify the graph in place. Default values are subject to change,</span>
<span class="sd">    so far they seem to work fine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the approximate number of nodes and edges</span>
    <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="n">content_size</span> <span class="o">=</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">size_per_element</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">content_size</span><span class="p">)</span>
    <span class="n">size_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visual_graph</span><span class="o">.</span><span class="n">graph_attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size_str</span><span class="p">,)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="torchview.computation_graph.ComputationGraph.rollify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rollify</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Rolls computational graph by identifying recursively used
Modules. This is done by giving the same id for nodes that are
recursively used.
This becomes complex when there are stateless and torch.functions.
For more details see docs</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rollify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur_node</span><span class="p">:</span> <span class="n">ModuleNode</span> <span class="o">|</span> <span class="n">FunctionNode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Rolls computational graph by identifying recursively used</span>
<span class="sd">    Modules. This is done by giving the same id for nodes that are</span>
<span class="sd">    recursively used.</span>
<span class="sd">    This becomes complex when there are stateless and torch.functions.</span>
<span class="sd">    For more details see docs&#39;&#39;&#39;</span>

    <span class="n">head_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">output_nodes</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">head_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_inner_tensors</span><span class="p">:</span>
        <span class="n">head_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">head_node</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>

    <span class="c1"># identify recursively used modules</span>
    <span class="c1"># with the same node id</span>
    <span class="n">output_id</span> <span class="o">=</span> <span class="n">get_output_id</span><span class="p">(</span><span class="n">head_node</span><span class="p">)</span>
    <span class="n">cur_node</span><span class="o">.</span><span class="n">set_node_id</span><span class="p">(</span><span class="n">output_id</span><span class="o">=</span><span class="n">output_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="torchview.computation_graph.compact_list_repr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compact_list_repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns more compact representation of list with
repeated elements. This is useful for e.g. output of transformer/rnn
models where hidden state outputs shapes is repetation of one hidden unit
output</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compact_list_repr</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;returns more compact representation of list with</span>
<span class="sd">    repeated elements. This is useful for e.g. output of transformer/rnn</span>
<span class="sd">    models where hidden state outputs shapes is repetation of one hidden unit</span>
<span class="sd">    output&#39;&#39;&#39;</span>

    <span class="n">list_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x_repr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">list_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_repr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">elem</span><span class="si">}</span><span class="s1">, &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_repr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cnt</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">elem</span><span class="si">}</span><span class="s1">, &#39;</span>

    <span class="c1"># get rid of last comma</span>
    <span class="k">return</span> <span class="n">x_repr</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="torchview.computation_graph.get_output_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_output_id</span><span class="p">(</span><span class="n">head_node</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This returns id of output to get correct id.
This is used to identify the recursively used modules.
Identification relation is as follows:
    ModuleNodes =&gt; by id of nn.Module object
    Parameterless ModulesNodes =&gt; by id of nn.Module object
    FunctionNodes =&gt; by id of Node object</p>

            <details class="quote">
              <summary>Source code in <code>torchview/computation_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_output_id</span><span class="p">(</span><span class="n">head_node</span><span class="p">:</span> <span class="n">COMPUTATION_NODES</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; This returns id of output to get correct id.</span>
<span class="sd">    This is used to identify the recursively used modules.</span>
<span class="sd">    Identification relation is as follows:</span>
<span class="sd">        ModuleNodes =&gt; by id of nn.Module object</span>
<span class="sd">        Parameterless ModulesNodes =&gt; by id of nn.Module object</span>
<span class="sd">        FunctionNodes =&gt; by id of Node object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">head_node</span><span class="p">,</span> <span class="n">ModuleNode</span><span class="p">):</span>
        <span class="n">output_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">head_node</span><span class="o">.</span><span class="n">compute_unit_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_id</span> <span class="o">=</span> <span class="n">head_node</span><span class="o">.</span><span class="n">node_id</span>

    <span class="k">return</span> <span class="n">output_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>